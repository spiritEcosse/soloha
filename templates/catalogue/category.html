{% extends "catalogue/browse.html" %}

{% load basket_tags %}
{% load promotion_tags %}
{% load category_tags %}
{% load product_tags %}
{% load catalogue %}
{% load product %}
{% load staticfiles %}
{% load i18n %}

{% block meta %}
    {% if page %}
        <meta name="robots" content="nofollow" />
    {% endif %}
{% endblock %}

{#{% block ngController %}ng-controller="" {% endblock ngController %}#}
{% block ngController%}ng-controller="More_goods"{% endblock ngController %}

{% load filters_concatenation %}

{% block title %}
    {{ category.meta_title }} | {{ block.super }}
{% endblock %}

{% block description %}
    {{ category.meta_description|default:""|striptags }}
{% endblock %}

{% block keywords %}
    {{ category.meta_keywords|default:""|striptags }}
{% endblock %}

{% block left-bar %}
    {% if filters %}
        <div class="heading">{% trans 'Selection of parameters' %}</div>
        <div class="filter">
            {% with url_extra_kwargs.filter_slug|split:'/' as select_filter %}
                {% regroup filters by parent as filters %}

                {% for filter in filters %}
                    <div class="items">
                        <div class="name" >{{ filter.grouper.title }}</div>
                        <div class="values">
                            <ul class="list-group">
                                {% for value in filter.list %}
                                    <li class="list-group-item checkbox">
                                        <label>
                                            {% if value.slug|in_list:select_filter %}
                                                {% assign clear_filter select_filter|remove:value.slug %}
                                            {% else %}
                                                {% assign clear_filter select_filter|append:value.slug %}
                                            {% endif %}

                                            <a href="{% reverse_url 'catalogue:category' url_extra_kwargs filter_slug=clear_filter|join_list:"/"|default:None %}">
                                                <input type="checkbox" {% if value.slug|in_list:select_filter %} checked{% endif %} />
                                                {{ value.title }}
                                                <span class="count">({{ value.count_products }})</span>
                                            </a>
                                        </label>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                {% endfor %}
            {% endwith %}
        </div>
    {% endif %}
{% endblock left-bar %}

{% block breadcrumbs %}
    <ol class="breadcrumb">
        <li>
            <a href="{{ homepage_url }}">{% trans "Home" %}</a>
        </li>
        {% for category in category.get_ancestors %}
            <li>
                <a href="{{ category.get_absolute_url }}">{{ category.name }}</a>
            </li>
        {% endfor %}
        <li class="active">{{ category.name }}</li>
    </ol>
{% endblock %}

{% block headertext %}{{ category.name }}{% endblock %}

{% block content %}
    <div class="row categories">
        <div class="col-xs-18 col-sm-21">
            <div class="row relative">
                <div class="col-xs-1 prevSlide absolute" id="goToPrevSlide"></div>
                <div class="col-xs-22 col-xs-offset-1">
                    <div class="lightSlider">
                        <a href="{{ category.get_absolute_url }}">
                            {% for children in category.children.all %}
                                <div class="col-xs-12 col-sm-4 item text-center">
                                    <a href="{{ children.get_absolute_url }}">
                                        <img src="/media/images/make_up/almeriya1-200x100-.png" class="img-responsive"/>
                                        <div class="title">{{ children }}</div>
                                    </a>
                                </div>
                            {% endfor %}
                        </a>
                    </div>
                </div>
                <div class="col-xs-1 nextSlide absolute" id="goToNextSlide"></div>
            </div>
        </div>
        <div class="col-xs-3 col-sm-3 text-center">
            <a href="#"><div class="arrow"></div>Посмотреть все кровати</a>
        </div>
    </div>

    <div class="row sort">
        <div class="col-xs-8">
        </div>
        <div class="col-xs-16">
            <span class="text">Сортировать:</span>
            <div class="btn-group btn-group-md" role="group" aria-label="Sort">
                {% with url_extra_kwargs.sort|default:orders.0.argument as select_order %}
                    {% for order in orders %}
                        {% if forloop.first %}
                            {% assign sort None %}
                        {% else %}
                            {% assign sort order.argument %}
                        {% endif %}
                        <a href="{% reverse_url 'catalogue:category' url_extra_kwargs sort=sort %}"
                           class="btn {% if select_order == order.argument %} btn-danger disabled{% else %} btn-default{% endif %}"
                           title="{{ order.title }}">
                            {{ order.title }}
                        </a>
                    {% endfor %}
                {% endwith %}
            </div>
        </div>
    </div>

    <div class="row items">
        {% if page_obj %}
            {% for product in page_obj %}
                <div class="col-sm-6 col-md-6">
                    {% include "catalogue/partials/product.html" %}
                </div>
            {% endfor %}
            <div class="clearfix"></div>
            <div name="more_products" class="col-xs-6 col-xs-offset-8 wrapper" action=".">
                {% csrf_token %}
                {% if page_obj.number != paginator.num_pages %}
                    <a href="#" class="more_products" ng-click="submit()" ng-hide="hide == true"> {#  onclick="location.href='/test/'" #}
                        ПОКАЗАТЬ ЕЩЕ
                    </a>
                {% endif %}
            </div>
            <div>
                {% include "catalogue/partials/pagination.html" %}
            </div>
        {% else %}
            <div class="nonefound col-xs-24">{% trans "No products found." %}</div>
        {% endif %}
    </div>
{% endblock %}

{% block post_content %}
    <div class="row">
        <div class="col-xs-24 category">
            <div class="description">
                {{ category.description|default:""|striptags }}
                <div class="gradientback"></div>
            </div>
            <div class="text-right">
                <a href="#" class="more">Читать полностью --></a>
            </div>
        </div>
    </div>
{% endblock %}
