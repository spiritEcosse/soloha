{% extends "base.html" %}
{% load staticfiles %}
{% load compress %}
{% load promotion_tags %}
{% load thumbnail %}
{% load i18n %}
{% load cache %}

{% block extrascripts %}
    {{ block.super }}
    <script src="{% static "bower_components/angular-animate/angular-animate.min.js" %}" type="text/javascript"></script>
    <script src="{% static "bower_components/angular-scroll/angular-scroll.min.js" %}" type="text/javascript"></script>
    <script src="{% static 'src/js/coffee_common/app.js' %}"></script>
{% endblock extrascripts %}

{% block layout %}
    {# Top-horizontal bar with account, notifictions, dashboard links #}
    {% if user.is_authenticated and user.is_staff %}
        {% include "partials/nav_accounts.html" %}
    {% endif %}

    <div class="container page" {% block ngApp %}ng-app="soloha"{% endblock ngApp %}>
        {#    <div class="container page" >#}
        {# Site logo/title, mini-basket, browse dropdown and searchbox #}
        <header ng-controller="Header">
            <div class="row top">
                <div class="col-xs-4 hidden-xs">
                    {% include "partials/brand.html" %}
                </div>
                {% if current_site.info.phone_number %}
                    <div class="col-xs-12 col-sm-13 col-md-14 phones">
                        {% with count_phone_numbers=current_site.info.phone_number|length %}
                            <span class="{% if count_phone_numbers < 4 %}hidden-sm hidden-xs {% else %}hidden-md hidden-sm hidden-xs {% endif %}">
                                {% for phone in current_site.info.phone_number %}
                                    <a class="text-white" href="tel:{{ phone }}">{{ phone|phone2numeric }}</a>
                                {% endfor %}
                            </span>

                            <div class="pull-right {% if count_phone_numbers < 4 %}visible-sm visible-xs {% else %}visible-md visible-sm visible-xs {% endif %}">
                                <button type="button" class="btn btn-transparent dropdown-toggle text-white" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <strong>{% trans 'Phones' %} <span class="caret"></span></strong>
                                </button>
                                <ul class="dropdown-menu stop-propagation">
                                    {% for phone in current_site.info.phone_number %}
                                        <li><a class="text-white" href="tel:{{ phone }}">{{ phone|phone2numeric }}</a></li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endwith %}
                    </div>
                {% endif %}
                <div class="col-xs-8 col-sm-7 col-md-6 cart">
                    {# Mini-basket wrapped in a block so some templates can now display it #}
                    {% block mini_basket %}{% include "partials/mini_basket.html" %}{% endblock %}
                </div>
            </div>
            <div class="row center">
                <div class="col-xs-10 col-sm-5">
                    <a href="{% url 'promotions:home' %}" class="logo"></a>
                </div>
                <div class="col-xs-12 col-sm-19 pages">
                    <nav class="navbar navbar-primary">
                        <div class="container-fluid">
                            <div class="navbar-header">
                                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                                    <span class="sr-only">Toggle navigation</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                                <a class="navbar-brand" href="#">{% trans "Company" %}</a>
                            </div>
                            <div id="navbar" class="collapse navbar-collapse">
                                <ul class="nav navbar-nav">
                                    <li class="active"><a href="#">{% trans "Contacts" %}</a></li>
                                    <li><a href="#">{% trans "Shipping and payment" %}</a></li>
                                    <li><a href="#">{% trans "For buyers" %}</a></li>
                                </ul>
                            </div>
                        </div>
                    </nav>

                    <div class="input-group input-group-lg search">
                        <input type="text" ng-model="search" ng-change="update_products()" data-toggle="dropdown"
                               class="form-control" placeholder="{% trans 'You are looking for something' %}?">

                        <div class="input-group-btn">
                            {% verbatim %}
                            <button ng-href="/search/?q={{ search_string }}" class="btn btn-default dropdown-toggle" type="button" id='search-show'>
                                <span class="glyphicon glyphicon-search"></span> Search
                            </button>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="search-show" name="search-menu" ng-model="display" ng-style="{ 'display': display }">
                                <div class="item col-xs-24" ng-repeat="product in searched_products">
                                    <a href="{{ product.href }}">
                                        <div class="col-xs-4">
                                            <img src="{{ product.main_image }}" class="img-responsive" />
                                        </div>
                                        <div class="col-xs-20">
                                            <div class="title">
                                                {{ product.title }}
                                            </div>
                                            <div class="price">{{ product.price }}</div>
                                        </div>
                                        <div class="col-xs-1 icon">
                                            <span class="glyphicon glyphicon-chevron-right"></span>
                                        </div>
                                    </a>
                                </div>
                                <div class="item col-xs-24 text-center">
                                    <a href="/search/?q={{ search_string }}">
                                        <div class="col-xs-24">
                                            <div class="title">
                                                All search results
                                                <span class="glyphicon glyphicon-chevron-right"></span>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                            {% endverbatim %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottom row">
                <nav class="yamm navbar navbar-primary">
                    <div class="container-fluid">
                        <div class="navbar-header">
                            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar_menu" aria-expanded="false" aria-controls="navbar_menu">
                                <span class="sr-only">Toggle navigation</span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
                            <a class="navbar-brand" href="/">
                                <span class="main" aria-hidden="true"></span>{% trans "Home" %}
                            </a>
                        </div>
                        {% if categories %}
                            <div id="navbar_menu" class="collapse navbar-collapse">
                                    <ul class="nav navbar-nav">
                                        {% for category in categories %}
                                            <li class="dropdown">
                                                <a role="button" class="dropdown-toggle" data-toggle="dropdown"
                                                   title="{{ category.name }}">
                                                    {% if category.icon %}
                                                        <img src="{{ category.icon|thumbnail_url:'category_icon' }}"
                                                             alt="{{ category.name }}"
                                                             title="{{ category.name }}" class="img-responsive icon"/>
                                                    {% endif %}
                                                    {{ category.name }}
                                                </a>
                                                <div class="arrow"></div>
                                                <div class="dropdown-menu stop-propagation" role="menu" aria-labelledby="dropdownMenu">
                                                    <div class="yamm-content">
                                                        <div class="col-xs-6">
                                                            <ul class="list-group nav nav-tabs nav-stacked" id="categories" role="tablist">
                                                                {% for category in category.children.all %}
                                                                    <li role="presentation" class="list-group-item{% if forloop.first %} active{% endif %}">
                                                                        <a data-toggle="tab" role="tab" class="text-left" href="#{{ category.slug }}">
                                                                            <div class="wrapper pull-left">{{ category.name }}</div>
                                                                            <span class="glyphicon glyphicon-menu-right pull-right"></span>
                                                                        </a>
                                                                    </li>
                                                                {% endfor %}
                                                                <li class="list-group-item" role="presentation">
                                                                    <a href="{{ category.get_absolute_url }}">
                                                                        {{ category }}
                                                                        <span class="glyphicon glyphicon-menu-right"></span>
                                                                    </a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="col-xs-6">
                                                            <div class="tab-content">
                                                                {% for category in category.children.all %}
                                                                    <div role="tabpanel" class="tab-pane{% if forloop.first %} active{% endif %}" id="{{ category.slug }}">
                                                                        <div class="panel panel-default">
                                                                            <div class="panel-heading">
                                                                                <a href="{{ category.get_absolute_url }}">{{ category.name }}</a>
                                                                            </div>
                                                                            <div class="panel-body">
                                                                                <ul class="list-group">
                                                                                    {% for category in category.children.all %}
                                                                                        <li class="list-group-item text-left">
                                                                                            <a href="{{ category.get_absolute_url }}">{{ category.name }}</a>
                                                                                        </li>
                                                                                    {% endfor %}
                                                                                </ul>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                {% endfor %}
                                                            </div>
                                                        </div>
                                                        {% if category.image_banner and category.link_banner %}
                                                            <div class="col-xs-12 text-right image">
                                                                <img src="{{ category.image_banner }}" class="img-responsive pull-right" title="" alt=""/>
                                                                <a class="btn btn-default btn-menu btn-xs" href="{{ category.link_banner }}">{% trans "Хочу" %}</a>
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                </div>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                        {% endif %}
                    </div>
                </nav>
            </div>
        </header>

        <div class="row main" {% block ngController%}{% endblock ngController %}>
            <div class="col-xs-24">
                {% block breadcrumbs %}{% endblock %}
            </div>

            {% block content_wrapper %}
                {% block checkout_nav %}{% endblock %}

                <div class="col-xs-24">
                    {% block header %}
                        <div class="row page-header action">
                            <h1>{% block headertext %}{% endblock %}</h1>
                        </div>
                    {% endblock %}

                    {% block subheader %}{% endblock subheader %}
                    {% include "partials/alert_messages.html" %}
                </div>
                {% block modal %}{% endblock %}

                {# Div exists for AJAX updates to entire content section #}
                <div id="content_inner">{% block content %}{% endblock %}</div>

                {% block promotions %}{% endblock %}
                {% block footer_checkout %}{% endblock %}
            {% endblock content_wrapper %}
        </div>

        {% block footer %}
            <footer>
                <div class="row top"></div>
                <div class="row center">
                    <div class="col-xs-24 col-sm-6 row question">
                        <div class="row">
                            {% if current_site.work_time or current_site.address or current_site.phone_number or current_site.email%}
                                <div class="title">{% trans "Questions?" %}</div>
                                {% if current_site.work_time %}
                                    <div class="row item line-top">
                                        <div class="col-xs-4 row icon">
                                            <span class="glyphicon glyphicon-time"></span>
                                        </div>
                                        <div class="col-xs-20 text">
                                            {{ current_site.work_time }}
                                        </div>
                                    </div>
                                {% endif %}
                                {% if current_site.address %}
                                    <div class="row item line-top">
                                        <div class="col-xs-4 row icon">
                                            <span class="glyphicon glyphicon-map-marker"></span>
                                        </div>
                                        <div class="col-xs-20 text">
                                            {{ current_site.address }}
                                        </div>
                                    </div>
                                {% endif %}
                                {% if current_site.phone_number %}
                                    <div class="row item line-top">
                                        <div class="col-xs-4 row icon">
                                            <span class="glyphicon glyphicon-phone-alt"></span>
                                        </div>
                                        <div class="col-xs-20 text">
                                            {{ current_site.phone_number }} <br/>
                                        </div>
                                    </div>
                                {% endif %}
                                {% if current_site.email %}
                                    <div class="row item line-top">
                                        <div class="col-xs-4 row icon">
                                            <span class="glyphicon glyphicon-envelope"></span>
                                        </div>
                                        <div class="col-xs-20 text">{{ current_site.email }}</div>
                                    </div>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-xs-24 col-sm-6 column">
                        {% if info_pages %}
                            <div class="title line-bottom">{% trans "Information" %}</div>
                            <ul class="list-group">
                                {% for page in info_pages %}
                                    <li><a href="{{ page.get_absolute_url }}">{{ page.title }}</a></li>
                                {% endfor %}
                            </ul>
                        {% endif %}
{#                        <div class="col-xs-24 special line-top">#}
{#                            <a href="#">#}
{#                                {% trans "Special offers" %}</a>#}
{#                            /#}
{#                            <a href="#">#}
{#                                {% trans "Sales" %}#}
{#                            </a>#}
{#                        </div>#}
                    </div>
                    <div class="col-xs-24 col-sm-6 column">
                        <div class="title line-bottom">{% trans "Support service" %}</div>
                        <ul class="list-group">
                            <li class="list-group-item"><a href="{{ contacts }}">{% trans "Contact us" %}</a></li>
                            <li class="list-group-item"><a href="#">{% trans "Return purchase " %}</a></li>
                            <li class="list-group-item"><a href="#">{% trans "Site Map" %}</a></li>
                        </ul>
                    </div>
{#                    <div class="col-xs-24 col-sm-6 column account">#}
{#                        <div class="row">#}
{#                            <div class="title line-bottom">{% trans "Personal office" %}</div>#}
{#                            <ul class="list-group">#}
{#                                <li class="list-group-item"><a href="#">{% trans "Personal office" %}</a></li>#}
{#                                <li class="list-group-item"><a href="#">{% trans "Orders history" %}</a></li>#}
{#                                <li class="list-group-item"><a href="#">{% trans "Notes (0)" %}</a></li>#}
{#                            </ul>#}
{#                        </div>#}
{#                    </div>#}
{#                    <div class="col-xs-24 col-sm-12 text-center subscribe" ng-controller="Subscribe">#}
{#                        <div class="row">#}
{#                            <div class="title line-top">#}
{#                                {% trans "Sign up for discounts!" %}#}
{#                            </div>#}
{#                            <div class="input-group">#}
{#                                <form name="{{ form.form_name }}" method="post" ng-hide="send_form" novalidate>#}
{#                                    {% csrf_token %}#}
{#                                    {% for field in form %}#}
{#                                        <div class="col-xs-6 element">#}
{#                                            {{ field.label_tag }}#}
{#                                            {{ field }}#}
{#                                            {{ field.errors }}#}
{#                                        </div>#}
{#                                    {% endfor %}#}
{#                                    <div class="col-xs-6 element">#}
{#                                        <button type="button" ng-disabled="{{ form.form_name }}.$invalid" ng-click="subscribe()" class="btn btn-danger btn-block">{% trans "Subscribe" %}</button>#}
{#                                    </div>#}
{#                                </form>#}
{#                                {% verbatim %}#}
{#                                <div class="alert alert-{{ alert_mode }}" role="alert" ng-show="send_form">#}
{#                                    {% endverbatim %}#}
{#                                    {{ answer }}#}
{#                                </div>#}
{#                            </div>#}
{#                            <div class="social">#}
{#                                <div class="title">{% trans "WE ARE IN SOCIAL NETWORKS JOIN US!" %}</div>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
                </div>
                <div class="row bottom">
                    <div class="col-xs-24 text-center text-white">
                        <strong>
                            Copyright {{ current_site.name }}
                            {% if current_site.info.shop_short_desc %}
                                - {{ current_site.info.shop_short_desc }}
                            {% endif %}
                            © 2012 - {% now "Y" %}
                        </strong>
                    </div>
                </div>
            </footer>
        {% endblock %}
    </div>
{% endblock %}

{% block onbodyload %}
    {{ block.super }}
    oscar.init();
{% endblock %}
